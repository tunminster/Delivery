{
    "listen": "test",
    "script": {
      "exec": [
        "var respcode=pm.response.code;",
        "if (respcode === 204) { ",
        "    retryOnNoContentResponse(); ",
        "}",
        "else {",
        "    if(!pm.response.text()) {",
        "        return;",
        "    }",
        "",
        "    var contentType = pm.response.headers.get('content-type');",
        "     if(contentType === 'application/pdf'){",
        "         console.log('ContentType - ' + contentType);",
        "          return;",
        "      }",
        "",
        "    var jsonData  = pm.response.json(); ",
        "}",
        "",
        "function retryOnNoContentResponse() {",
        "    let maxRetries = pm.environment.has(\"maxRetryCount\") && pm.environment.get(\"maxRetryCount\") || 5;",
        "    let retries = pm.environment.has(\"retries\") && pm.environment.get(\"retries\") || 1;",
        "",
        "    if(pm.response.code !== 200 && retries <= maxRetries){",
        "       pm.test(\"Received no content response, retrying...\"+respcode,function(){ ",
        "           console.log(\"Retrying \" + request.name + \", count: \" + retries)",
        "       }) ",
        "       if(retries < maxRetries) {",
        "          console.log(\"Resetting request\")",
        "          pm.environment.set(\"retries\", ++retries)",
        "          postman.setNextRequest(request.name)",
        "          setTimeout(() => {}, 3000)",
        "       }",
        "     }",
        "     else{",
        "         console.log(\"Max retries reached\")",
        "         pm.environment.unset(\"retries\")",
        "     }",
        "}"
      ],
      "type": "text/javascript"
    }
  }